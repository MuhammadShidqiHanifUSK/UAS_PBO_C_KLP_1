<!--
  File ini adalah template dashboard admin pada aplikasi UAS PBO.
  Fungsi utamanya adalah menampilkan ringkasan informasi penting terkait
  sistem pemesanan makanan, seperti total produk, total transaksi,
  total pengguna, dan total pendapatan yang berhasil diperoleh.

  Template ini menggunakan Thymeleaf sebagai template engine dengan layout fragmen header untuk konsistensi tampilan.

  Data yang ditampilkan berasal dari backend dan disediakan oleh AdminController pada endpoint /admin.
  Data tersebut meliputi:
  - products: Daftar produk yang ada di sistem
  - transactions: Daftar transaksi yang terjadi
  - users: Daftar pengguna yang terdaftar di sistem

  Tampilan dashboard terdiri dari:
  - Statistik utama dalam bentuk kartu untuk total produk, transaksi, pengguna, dan pendapatan
  - Daftar produk terbaru (maksimal 5) beserta harga dan status stoknya
  - Daftar transaksi terbaru (maksimal 5) dengan detail ID, pengguna, total biaya, dan waktu transaksi
  - Tautan navigasi untuk mengelola produk, melihat laporan, mengelola pengguna, dan melihat transaksi detail
  - Form untuk tindakan cepat seperti menyimpan data manual dan logout

  Halaman ini hanya bisa diakses oleh admin yang sudah login,
  dan menjadi halaman utama bagi admin untuk memantau dan mengelola sistem pemesanan makanan.

  File ini terhubung langsung dengan AdminController.java pada backend yang mengelola logika dan penyediaan data untuk ditampilkan.
-->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/header}">
<head>
  <title>Dashboard Admin</title>
</head>
<body>
  <div layout:fragment="content">
    <div class="container admin-dashboard">
      <h1 class="page-header">Dashboard Admin</h1>
      <p class="welcome-subtitle">Kelola sistem pemesanan makanan Anda dengan alat admin yang powerful</p>

      <!-- Stats Cards -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number" th:text="${#lists.size(products)}">0</div>
          <div class="stat-label">Total Produk</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" th:text="${#lists.size(transactions)}">0</div>
          <div class="stat-label">Total Transaksi</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" th:text="${#lists.size(users)}">0</div>
          <div class="stat-label">Total Pengguna</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">Rp [[${#numbers.formatInteger(#aggregates.sum(transactions.![total]), 0, 'COMMA')}]]</div>
          <div class="stat-label">Total Pendapatan</div>
        </div>
      </div>

      <div class="row">
        <!-- Recent Products -->
        <div class="col">
          <div class="card">
            <div class="card-header">
              Produk Terbaru
            </div>
            <div class="card-body">
              <div th:if="${#lists.isEmpty(products)}" class="alert alert-warning">
                Tidak ada produk tersedia
              </div>
              <div th:if="${!#lists.isEmpty(products)}">
                <div th:each="product, iterStat : ${products}"
                     th:if="${iterStat.index < 5}"
                     class="product-card">
                  <div class="product-header">
                    <h3 th:text="${product.name}">Nama Produk</h3>
                    <div class="product-price">Rp [[${#numbers.formatInteger(product.price, 0, 'COMMA')}]]</div>
                  </div>
                  <div class="product-body">
                    <div class="product-stock" th:class="'product-stock ' + (${product.stock} > 10 ? 'available' : (${product.stock} > 0 ? 'low' : 'out'))"
                         th:text="'Stok: ' + ${product.stock}">Stok</div>
                  </div>
                </div>
              </div>
              <a th:href="@{/admin/products}" class="btn btn-primary w-100">
                Kelola Semua Produk
              </a>
            </div>
          </div>
        </div>

        <!-- Recent Transactions -->
        <div class="col">
          <div class="card">
            <div class="card-header">
              Transaksi Terbaru
            </div>
            <div class="card-body">
              <div th:if="${#lists.isEmpty(transactions)}" class="alert alert-warning">
                Belum ada transaksi
              </div>
              <div th:if="${!#lists.isEmpty(transactions)}">
                <table class="table">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Pengguna</th>
                      <th>Total</th>
                      <th>Tanggal</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr th:each="transaction, iterStat : ${transactions}"
                        th:if="${iterStat.index < 5}">
                      <td><code th:text="${transaction.id}"></code></td>
                      <td th:text="${transaction.userId}">Pengguna</td>
                      <td>Rp [[${#numbers.formatInteger(transaction.total, 0, 'COMMA')}]]</td>
                      <td th:text="${#temporals.format(transaction.timestamp, 'dd/MM/yyyy HH:mm')}">Tanggal</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <a th:href="@{/admin/transactions}" class="btn btn-primary w-100">
                Lihat Semua Transaksi
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="card">
        <div class="card-header">
          Tindakan Cepat
        </div>
        <div class="card-body">
          <div class="grid-actions">
            <a th:href="@{/admin/products}" class="btn btn-success">
              Tambah Produk Baru
            </a>
            <a th:href="@{/admin/reports}" class="btn btn-warning">
              Lihat Laporan
            </a>
            <a th:href="@{/admin/users}" class="btn btn-secondary">
              Kelola Pengguna
            </a>
            <a th:href="@{/admin/transactions}" class="btn btn-info">
              Lihat Transaksi
            </a>
            <form th:action="@{/admin/save}" method="post">
              <button type="submit" class="btn btn-primary">
                Simpan Data
              </button>
            </form>
            <form th:action="@{/logout}" method="post">
              <button type="submit" class="btn btn-danger">
                Keluar
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
